{% extends "base.html" %}

{% block title %}{{ team.team_name }} | Perfecto{% endblock %}

{% block content %}
<div class="columns">
    <div class="column is-3">
        <div class="box">
            <aside class="menu">
                <p class="menu-label">
                    Управление
                </p>
                <ul class="menu-list">
                    <li><a href="{% url 'team_list' %}">Назад к списку</a></li>
                    <li><a href="{% url 'company_detail' company_id=team.company.id %}">К компании</a></li>
                    {% if is_manager or is_owner %}
                    <li><a href="{% url 'team_add_user' team_id=team.id %}">Добавить пользователя</a></li>
                    <li><a href="{% url 'perfreview_create_team' team_id=team.id %}">Запустить перфревью для всей команды</a></li>
                    {% endif %}
                </ul>
            </aside>
        </div>
    </div>
    <div class="column">
        <div class="box">
            <h1 class="title">{{ team.team_name }}</h1>
            <h2 class="subtitle">{{ team.company.company_name }}</h2>
            
            <div class="content">
                <p>{{ team.team_description }}</p>
                {% if is_owner %}
                <p><span class="tag is-success">Владелец</span></p>
                {% elif is_manager %}
                <p><span class="tag is-info">Менеджер</span></p>
                {% endif %}
            </div>

            <hr>
            
            <h2 class="title is-4">Участники команды</h2>
            <table class="table is-fullwidth">
                <thead>
                    <tr>
                        <th>Имя</th>
                        <th>Email</th>
                        <th>Должность</th>
                        <th>Роль</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tu in team_users %}
                    <tr>
                        <td>{{ tu.user.user_name }}</td>
                        <td>{{ tu.user.email }}</td>
                        <td>{{ tu.user.user_job }}</td>
                        <td>
                            {% if tu.is_owner %}
                            <span class="tag is-success">Владелец</span>
                            {% elif tu.is_manager %}
                            <span class="tag is-info">Менеджер</span>
                            {% else %}
                            <span class="tag is-light">Участник</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if is_manager or is_owner %}
                            <a href="{% url 'perfreview_create_user' team_id=team.id user_id=tu.user.id %}" 
                               class="button is-small is-primary">
                                <span class="icon">
                                    <i class="fas fa-chart-line"></i>
                                </span>
                                <span>Запустить перфревью</span>
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <hr>
            
            <h2 class="title is-4">Последние перфревью</h2>
            {% with reviews=team.reviews.all|slice:":5" %}
            {% if reviews %}
            <div class="table-container">
                <table class="table is-fullwidth">
                    <thead>
                        <tr>
                            <th>Сотрудник</th>
                            <th>Создано</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for review in reviews %}
                        <tr>
                            <td>{{ review.user.user_name }}</td>
                            <td>{{ review.created|date:"d.m.Y H:i" }}</td>
                            <td>
                                <a href="{% url 'perfreview_detail' review_id=review.id %}" class="button is-small is-info">
                                    <span class="icon">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                    <span>Просмотр</span>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="notification is-info is-light">
                <p>В этой команде пока нет перфревью.</p>
            </div>
            {% endif %}
            {% endwith %}
        </div>
    </div>
</div>
{% endblock %}
